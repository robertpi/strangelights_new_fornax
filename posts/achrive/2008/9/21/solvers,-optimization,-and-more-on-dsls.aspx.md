---
title: "Solvers, Optimization, and more on DSLs"
date: 2008-09-21T14:13:20.3330000
draft: false
---

<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">To coincide with the release the CTP release of F# Microsoft also released and early version <a href="http://code.msdn.microsoft.com/solverfoundationfs1">“Solver Foundation”</a>. Don Box described himself as <a href="http://www.pluralsight.com/community/blogs/dbox/archive/2008/08/29/elation.aspx">being elated by its release</a>. You can tell it’s an early version as it’s currently the only way to get it is part of <a href="http://code.msdn.microsoft.com/solverfoundationfs1">“F# Optimization Modelling Language” sample on the MSDN code gallery</a>.</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">So what does optimization mean in this context? Simply put an optimization problem is the problem of finding the best solution from all feasible solutions. Or (slightly) more formally: </font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">Given a function “f” which takes a value from set “A” and transforms it to a real number, find the element “x0” in set “A” which “f(x0)” is smaller (or greater) than “f(x)” where “x” is all other values in A. </font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">Many problems from physics and mathematics can be modelled using this simple framework and much mathematical research has gone into finding the solution efficiently. For example the travelling salesman can be considered an optimization problem, our function “f” (often referred to as the cost function) is the cost of travelling between the nodes in the chosen order. Our set “A” is the set of all possible routes between the nodes. So it is an optimization problem because we are looking for the element in the set of all possible routes which makes our function “f” – the cost function – return the best (smallest/cheapest) value. Wikipedia currently has two articles on optimization that maybe merged in the future:</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3"><a href="http://en.wikipedia.org/wiki/Optimization_(mathematics)">http://en.wikipedia.org/wiki/Optimization_(mathematics)</a></font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><a href="http://en.wikipedia.org/wiki/Optimization_problem"><font face="Calibri" color="#800080" size="3">http://en.wikipedia.org/wiki/Optimization_problem</font></a></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">Solvers are pieces of software that aim to solve an optimization problem. To use a solver we generally have to describe the problem to the solver. So if we were trying to solve the travelling salesman problem to the solver we would have to input a description of all possible routes between the nodes in our graph and tell it how to compute the cost function for each element in the set of all possible routes. Depending on the API that the solver offers this might be ease or quite difficult. The Solver Foundation is a set of solvers implemented as a .NET library with a classical object model interface, the F# Optimization Modelling Language is a DSL that offers an alternative way to describe the your problem optimization.</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">The F# Optimization Modelling Language allows you to solve linear equations. Solving linear equations may sound quite easy, image we have the equation: </font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">20.0 * sa + 15.0 * vz</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">You can pretty much straight away tell me the maximum value is infinity and the minimum value is negative infinity. If I add a simple constrain the variables “sa” and “vz”: </font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">0 &lt; sa &lt; 500</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">0 &lt; vz &lt; 200</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">you can probably still easily tell me that the minimum value is 0 and the maximum is<span style="mso-spacerun: yes">  </span>13000 (20 * 500 + 15 * 200). However if we were to add more constrains and variables the problem would quickly become two difficult to solve with a pen and paper. The DSL uses a using a <a href="http://en.wikipedia.org/wiki/Simplex_method">simplex solver</a> “under the hood” and if you check out the <a href="http://en.wikipedia.org/wiki/Simplex_method">Wikipedia article</a> you can see the maths of this are quite challenging.</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">So how does the DSL work? The DSL re-interprets an F# quoted expression and inputs this into the SimplexSolver class which is available in the Microsoft.Solver.Foundation.dll. The quoted expression must have the form: </font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">variable declarations</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">cost/goal function</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">constraints</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">More concretely an example of the syntax looks like this:</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes">&lt;@<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span><span style="COLOR: blue">let</span> sa = var <span style="COLOR: #a31515">"SA"<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span><span style="COLOR: blue">let</span> vz = var <span style="COLOR: #a31515">"VZ"<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">  </span><span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span>minimise (20.0 * sa + 15.0 * vz)<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span><o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span>where<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">        </span>[<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>0.3 * sa + 0.4 * vz &gt;= 2000.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>0.4 * sa + 0.2 * vz &gt;= 1500.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>0.2 * sa + 0.3 * vz &gt;= 500.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>sa &lt;= 9000.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span></span><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes">vz &lt;= 6000.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>sa &gt;= 0.;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">            </span>vz &gt;= 0.<span style="mso-spacerun: yes">  </span><o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">        </span>]<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><span style="FONT-SIZE: 10pt; LINE-HEIGHT: 115%; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes">@&gt;</span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">Here we can see we have two variables sa and vz and an we’re trying to find the minimum value of the equation 20.0 * sa + 15.0 * vz, at the end we have a set of constrains that the solution must conform to. As this is a quotation, it is a data structure rather than code, so it can be interpreted rather like a C# expression tree can. So the whole quoted expression is then passed to a function to be interpreted by making calls to the underlying object model exposed by the Microsoft.Planning.Solvers.dll and then hopefully solved. So to put you out of your misery the minimum value of this equation, give the constraints, is 92500.0 where SA = 2000.0 and VZ = 3500.0.</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">So why would be use a DSL to input this problem rather than using the classical object model? Well in short it’s simpler and easier to use. To illustrate this point I’ve rewritten the previous example as a C# program, which is clearly a lot longer, but worse than that it feels a lot more like programming, the meaning of our expressions is hidden in amongst lots of variable declarations and method calls:</font></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span><span style="COLOR: blue">static</span> <span style="COLOR: blue">void</span> Main(<span style="COLOR: blue">string</span>[] args) {<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: #2b91af">SimplexSolver</span> simplexSolver = <span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">SimplexSolver</span>();<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> saId;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> vzId;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">  </span><span style="mso-spacerun: yes">    </span>simplexSolver.AddVariable(<span style="COLOR: #a31515">"SA"</span>, <span style="COLOR: blue">out</span> saId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddVariable(<span style="COLOR: #a31515">"VZ"</span>, <span style="COLOR: blue">out</span> vzId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//0.3 * sa + 0.4 * vz &gt;= 2000.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> constraint1;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddRow(<span style="COLOR: #a31515">"constraint1"</span>, <span style="COLOR: blue">out</span> constraint1);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint1, saId, 0.3);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint1, vzId, 0.4);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetLowerBound(constraint1, 2000.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//0.4 * sa + 0.2 * vz &gt;= 1500.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> constraint2;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddRow(<span style="COLOR: #a31515">"constraint2"</span>, <span style="COLOR: blue">out</span> constraint2);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint2, saId, 0.4);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint2, vzId, 0.2);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetLowerBound(constraint2, 1500.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//0.2 * sa + 0.3 * vz &gt;= 500.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> constraint3;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddRow(<span style="COLOR: #a31515">"constraint3"</span>, <span style="COLOR: blue">out</span> constraint3);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint3, saId, 0.2);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(constraint3, vzId, 0.3);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetLowerBound(constraint3, 500.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//sa &lt;= 9000.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetUpperBound(saId, 9000.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//vz &lt;= 6000.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetUpperBound(vzId, 6000.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//sa &gt;= 0.;<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetLowerBound(saId, 0.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//vz &gt;= 0.<span style="mso-spacerun: yes">  </span><o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetLowerBound(vzId, 0.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: green">//minimise (20.0 * sa + 15.0 * vz)<o:p></o:p></span></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">int</span> goalId;<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddRow(<span style="COLOR: #a31515">"goal1"</span>, <span style="COLOR: blue">out</span> goalId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(goalId, saId, 20.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.SetCoefficient(goalId, vzId, 15.0);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.AddGoal(goalId, 1, <span style="COLOR: blue">true</span>);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><o:p> </o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span>simplexSolver.Solve(<span style="COLOR: blue">new</span> <span style="COLOR: #2b91af">SimplexSolverParams</span>());<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span></span><span lang="FR" style="FONT-SIZE: 10pt; COLOR: blue; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes">double</span><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"> sa = (<span style="COLOR: blue">double</span>)simplexSolver.GetValue(saId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: #2b91af">Console</span>.WriteLine(<span style="COLOR: #a31515">"SA: {0}"</span>, sa);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">double</span> vz = (<span style="COLOR: blue">double</span>)simplexSolver.GetValue(vzId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: #2b91af">Console</span>.WriteLine(<span style="COLOR: #a31515">"VZ: {0}"</span>, vz);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: blue">double</span> goal = (<span style="COLOR: blue">double</span>)simplexSolver.GetValue(goalId);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span><span style="COLOR: #2b91af">Console</span>.WriteLine(<span style="COLOR: #a31515">"Goal: {0}"</span>, goal);<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: normal; mso-layout-grid-align: none"><span lang="FR" style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-ansi-language: FR; mso-no-proof: yes"><span style="mso-spacerun: yes">      </span></span><span style="FONT-SIZE: 10pt; COLOR: #2b91af; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes">Console</span><span style="FONT-SIZE: 10pt; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes">.ReadLine();<o:p></o:p></span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><span style="FONT-SIZE: 10pt; LINE-HEIGHT: 115%; FONT-FAMILY: &quot;Courier New&quot;; mso-no-proof: yes"><span style="mso-spacerun: yes">    </span>}</span></p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 10pt"><font face="Calibri" size="3">But at the end of the day I think it’s nice to of the choice of interface to have the choice of interface, especially as currently the F# Optimization Modelling Language only exposes a small sub-set of the Solver Foundation. Sometimes you’ll want to work with the lower level object model; often you’ll want to abstract this away to a DSL which allows you to describe the problem you’re solving rather than having to program it. Probably the most interesting job will be coming up with new DSL to describe specific optimization problems. Any one fancy writing a travelling sales</font><font face="Calibri" size="3">man DSL?</font></p>

### Feedback:

*Feedback was imported from my only blog engine, it's no longer possible to post feedback here.*

**re: Solvers, Optimization, and more on DSLs - Al**

Finally after a month somebody actually writes about how to use this stuff.  You have to wonder with the state of the documentation and examples if they really want anybody to use the solver...<br /><br />Thanks Robert!

**re: Solvers, Optimization, and more on DSLs - [Alexander Stojanovic](http://code.msdn.microsoft.com/solverfoundation)**

The CTP of Microsoft Solver Foundation that just shipped on Monday and which is available at http://code.msdn.microsoft.com/solverfoundation comes with full documentation, models and sample projects in several CLR languages (C#, F#, IronPython) as well as a full Excel2007 Designer Add-in so that you can model and solve from within Excel (with nice declarative data binding to cells/ranges/worksheets). It incudes programming against what we term the "Solver Foundation Services" layer or against the low-level solver APIs. The SFS gives you nice features liek LINQ data binding and automatic parallelism of your model solving using declarative mechanisms (called directives). Try it out. The installer puts all of the docs, models, and samples in your My Documents folder under "Microsoft Solver Foundation" including a step by step guide to using the Excel Add-in.<br /><br />Alexander Stojanovic (GM/MSF)<br />

**re: Solvers, Optimization, and more on DSLs - [Robert Pickering](http://strangelights.com/)**

Yes, I've already downloaded the new version and agree the documentation is much better! It looks like the start of a nice product.<br /><br />Cheers,<br />Rob

**re: Solvers, Optimization, and more on DSLs - Alexander Stojanovic**

Thank you for the kind words Rob. The team appreciates all feedback. Your article was very well done. We'll be interested in your experiences using OML (Optimization Modeling Language) which is a super-set of the F# DSL (that our colleague Ralf Herbrich did a superb job on btw). You can try it out in the Excel Add-in Designer and lay with OML directly or via the Object Model in C# and other languages. The object model is a type safe way of programming with Solver Foundation but essentially exposes a (nearly) isomorphic version of OML. The only difference being the way we perform data binding in Excel (using cell/range/worksheet binding) versus in a NETfx solution (LINQ). <br /><br />Regards,<br />Alexander Stojanovic (GM/MSF)

